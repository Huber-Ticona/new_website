{% extends 'layout.html' %}

{% block encabezado %}
<link rel="stylesheet" href="{{url_for('tienda_bp.static', filename= 'css/carro.css')}}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
<title>Mi Carro</title>
{% endblock %}

{% block contenido %}
{% if carro %}
{% set productos = carro['productos']%}
<div class="container-fluid" style="border: 1px solid green;">
    <div class="carro-encabezado"><span class="carro-encabezado-cantidad">{{productos|length}} productos </span>en el carro.</div>
            
    <div class="row m-3">
        <div class="col-md-8">
            <div class="carro-items">
                
                {%for item in productos %}
            <div class="carro-item">
                    <div class="row m-0 p-0">
                        <div class="col-1 m-0 p-0 d-flex flex-column justify-content-center align-items-center" >
                            <span><i class="fa-solid fa-caret-up"></i></span>
                            {{item['cantidad']}}
                            <span><i class="fa-solid fa-caret-down"></i></span>
                        </div>
                        <div class="col-2  m-0 p-0">
                            <img src="{{url_for('api_bp.imagen_producto' , nombre = item['url_imagen'] ) }}" alt="" class="img-fluid" style="height: 100px;">
                        </div>
                        <div class="col m-0 p-0">
                            <p class="carro-item-titulo">{{item['nombre_producto']}}</p>
                        </div>
                        

                        <div class="col-2 m-0 p-0 d-flex flex-column justify-content-between">
                            <p class="carro-item-precio">${{item['precio_unitario'].replace(',','.')}}</p>
                            <i class="fa-solid fa-x text-center"></i>   
                        </div>
                    </div>

            </div>
            {%endfor%}
            </div>
        </div>
        <div class="col-md-4 d-flex flex-column justify-content-between">
            
            <div>
                <div class="carro-resumen">
                <p>Resumen de cotizacion</p>
                {% set total = sum%}
                <p>Total: $450.000</p>
                </div>
                {% if current_user.is_anonymous == False %}
                <div class="text-center">
                    <button class="btn btn-secondary" style="background-color:#ec801d ;" onclick="descargar()">Descargar Cotizacion</button>
             
                </div>
                {%endif%}
                
            </div>
              
            <div class="text-center">
                <a href="javascript:history.back()" class="btn bg-none" > <i class="fa fa-arrow-left"></i>  Volver a la tienda</a>
            </div>
            
        </div>

    </div>
    

</div>
{% else %}
<div class="jumbotron">
    <h1>Tu carro esta vacio</h1>
    <p>No tienes ningun producto en tu carro.</p>
    <a class="btn btn-secondary" href="/inicio">Volver a la Tienda</a>
</div>
{% endif %}
<script>
    function descargar(){
        
        var len_carro = parseInt('{{carro|length}}')
        var productos_id = []
        var productos_precio = []
        for(let i = 0; i< len_carro; i ++ ){
            productos_id.push(parseInt)
        }
        var data = JSON.stringify({
            "usuario_id" : '{{current_user.id}}',
            "productos_id" : 'asdasd'
        })

        $.ajax({
            url : "{{url_for('tienda_bp.crear_cotizacion')}}",
            type: 'post',
            contentType: "application/json; charset=utf-8",
            data: data,
            success: function(resp){
                console.log('respuesta: ',resp.mensaje)
                toastr.success(resp.mensaje , 'success', {timeOut: 5000});
                
            }
        })
    }
</script>
{% endblock%}