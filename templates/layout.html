<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- BOOTSTRAP CSS 4.5-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Comforter&family=Open+Sans:wght@300&family=Quintessential&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{url_for('static', filename= 'css/layout.css')}}">

    {% block encabezado %}
    {% endblock %}
</head>
<body>
      <div class="principal_container d-flex">
      <div class="principal_sidebar d-flex">

        <div class="sidebar">
          <div class="sidebar_header">
              <img src="{{ url_for('static', filename= 'docs/enco_logov3.png') }}" alt="..." height="50" style="float: left;">
              <button class="btn  close-sidebar" style="float: right;"><i class="fa-solid fa-times"></i></button>
          </div>

          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="/">Inicio<span class="sr-only">(current)</span></a>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Tienda
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="/categoria/tableros">Tableros</a>
                <a class="dropdown-item" href="/categoria/quincalleria">Quincalleria</a>
                <a class="dropdown-item" href="/categoria/madera">Madera</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">etcet</a>
              </div>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="/servicios">Servicios</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/contacto">Contacto</a>
            </li>
            
            
          </ul>
        </div>
        <div class="sidebar_relleno">
        </div>
      </div>

      <div class="principal_contenido w-100">

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <a class="navbar-brand" href="/inicio">
            <img src="{{ url_for('static', filename= 'docs/enco_logov3.png') }}" alt="..." height="50">
          </a>

          <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
  
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
              <li class="nav-item active">
                <a class="nav-link" href="/">Inicio <span class="sr-only">(current)</span></a>
              </li>
  
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Tienda
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/categoria/tableros">Tableros</a>
                  <a class="dropdown-item" href="/categoria/quincalleria">Quincalleria</a>
                  <a class="dropdown-item" href="/categoria/madera">Madera</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="#">etcet</a>
                </div>
              </li>
  
              <li class="nav-item">
                <a class="nav-link" href="/servicios">Servicios</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/contacto">Contacto</a>
              </li>
              
              
            </ul>
            {% if current_user.is_anonymous == False %}
            <ul class="navbar-nav ml-auto">
              <a class="nav-item nav-link " href="/logout">Cerrar Sesión</a>
            </ul>
            {% endif %}
            <!-- search 
            <form class="form-inline my-2 my-lg-0">
              <input class="form-control mr-sm-2" type="search" placeholder="Search">
              <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>-->
          
         </div>

         <div class="box-navbar-derecho">
          {% if current_user.is_anonymous %}
          <div class="item-navbar-derecho">
            <a class="nav-link" href="/login"><i class="fa-solid fa-user fa-lg"></i> <span class="d-none d-lg-inline d-xl-inline">Iniciar Sesión</span></a>
          </div>
          {% else %}
          <div class="item-navbar-derecho">
            <a class="nav-link" href="/cuenta"><i class="fa-solid fa-user fa-lg"></i> <span class="d-none d-lg-inline d-xl-inline">Mi Cuenta</span></a>
          </div>
          {% endif %}

          <div class="item-navbar-derecho">
            <button type="button" class="boton-carro" onclick="ver_carro()"><i class="fa-solid fa-cart-shopping fa-md"></i></button>
          </div>
          

        <button class="btn w-100 d-lg-none open-sidebar" type="button">
          <span class="navbar-toggler-icon"></span>
        </button>
        
        </div>
          
        </nav>
        
        {% block contenido %}
        {% endblock %}
      </div>
      </div>
     
      <!--
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="/inicio">
          <img src="{{ url_for('static', filename= 'docs/enco_logov3.png') }}" alt="..." height="36">
        </a>

        
        <div class="box-navbar-derecho">
          {% if current_user.is_anonymous %}
          <div class="item-navbar-derecho">
            <a class="nav-link" href="/login"><i class="fa-solid fa-user"></i>Login</a>
          </div>
          {% else %}
          <div class="item-navbar-derecho">
            <a class="nav-link" href="/cuenta"><i class="fa-solid fa-user"></i>Mi cuenta</a>
          </div>
          {% endif %}

          <div class="item-navbar-derecho">
            <button type="button" class="boton-carro" onclick="ver_carro()"><i class="fa-solid fa-cart-shopping"></i></button>
          </div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        </div>
       
        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">

          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item active">
              <a class="nav-link" href="/">Inicio <span class="sr-only">(current)</span></a>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Tienda
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="/categoria/tableros">Tableros</a>
                <a class="dropdown-item" href="/categoria/quincalleria">Quincalleria</a>
                <a class="dropdown-item" href="/categoria/madera">Madera</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">etcet</a>
              </div>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="/servicios">Servicios</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/contacto">Contacto</a>
            </li>
            
            
          </ul>
          {% if current_user.is_anonymous == False %}
          <ul class="navbar-nav ml-auto">
            <a class="nav-item nav-link " href="/logout">Cerrar Sesión</a>
          </ul>
          {% endif %}
          <!-- search 
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form>
        
       </div>
        
      </nav>-->


    <!-- SIDE BAR 
    <button class="open-sidebar">ver</button>
    <div class="main-container d-flex">
      
      <div class="sidebar" id="side_nav">

        <div class="header-box">
          Filtros
          <button class="btn d-md-none d-block close-sidebar" style="float: right;"><i class="fa-solid fa-times"></i></button>
          
        </div>

        <ul class="list-unstyled">
            <li class="">
              <button class="btn d-md-none d-block w-100" onclick="abrir_categorias()"><span>Categoria</span><i class="fa-solid fa-caret-down"></i></button>
              <div class="cont_categorias">
                <ul class="list-unstyled">
                  <li>msd</li>
                  <li>melamina</li>
                </ul>
              </div>
            </li>
            <li class="">
              <button class="btn d-md-none d-block w-100" onclick="abrir_precios()"><span>Precio</span><i class="fa-solid fa-caret-down"></i></button>
              <div class="cont_precios">
              <ul class="list-unstyled">
                <li>0 - 50000</li>
                <li>50000 - 150000</li>
                <li>150000 o superior</li>
              </ul>
            </div>
            </li>
        </ul>

      </div>
      
    </div>
    -->
    
    <!-- Modal -->
    <div class="modal fade" id="modal-carro" data-backdrop="static" data-keyboard="false" tabindex="-1"
      aria-labelledby="staticBackdropLabel" aria-hidden="true">
      
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Carrito de compras</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <table class="table" id="tabla-carro">
              <thead>
                <th>Imagen</th>
                <th>Descripcion</th>
                <th>Cantidad</th>
                <th>clr</th>
              </thead>
              <tbody id="cuerpo-carro">
                <tr>
                  <td>jpg</td>
                  <td>melamina</td>
                  <td><button><i class="fa-solid fa-plus"></i></button><input type="number"  id="" value="1" ><button><i class="fa-solid fa-minus"></i></button></td>  
                  <td><button class="btn btn-outline-dark"><i class="fa-solid fa-trash"></i></button></td>
                </tr>
                
              </tbody>
            </table>
            <div class="carro-vacio">
              <p>El carro esta vacio</p>
            </div>

          </div>
          <div class="modal-footer">
            <button onclick="vaciar_carro()">Vaciar Carro</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            <a type="button" class="btn btn-primary" href="/mi-carro">Ir al carro de compras</a>
          </div>
        </div>
      </div>
    </div>

   

    <!-- FOOTER -->
    <div class="d-flex flex-column">
  
      <!-- FOOTER -->
      <footer class="w-100 py-4 flex-shrink-0">
          <div class="container py-4">
              <div class="row gy-4 gx-5">
                  <div class="col-lg-4 col-md-6">
                      <img src="{{ url_for('static', filename= 'docs/enco_logov3.png') }}" alt="..." height="120">
                      <p class="small text-muted" >Empresa N° 1 en Maderas</p>
                      <p class="small text-muted mb-0">&copy; Copyrights. All rights reserved. <a class="text-primary" href="#">Dev-Huber</a></p>
                  </div>
                  <div class="col-lg-2 col-md-6">
                      <h5 class="text-white mb-3">Accesos Rapidos</h5>
                      <ul class="list-unstyled text-muted">
                          <li><a href="#">Inicio</a></li>
                          <li><a href="#">Tienda</a></li>
                          <li><a href="#">Servicios</a></li>
                          <li><a href="#">Etc...</a></li>
                      </ul>
                  </div>
                  <div class="col-lg-2 col-md-6">
                      <h5 class="text-white mb-3">Productos Frecuentes</h5>
                      <ul class="list-unstyled text-muted">
                          <li><a href="#">Melaminas</a></li>
                          <li><a href="#">Terciados</a></li>
                          <li><a href="#">Rodones</a></li>
                          <li><a href="#">etc...</a></li>
                      </ul>
                  </div>
                  <div class="col-lg-4 col-md-6">
                      <h5 class="text-white mb-3">Suscripción</h5>
                      <p class="small text-muted">Dejanos tu correo para recibir gratis todas las novedades sobre los productos al instante.</p>
                      <form action="#">
                          <div class="input-group mb-3">
                              <input class="form-control" type="text" placeholder="Correo Electronico" aria-label="Recipient's username" aria-describedby="button-addon2">
                              <button class="btn btn-primary" id="button-addon2" type="button"><i class="fas fa-paper-plane"></i></button>
                          </div>
                      </form>
                  </div>
              </div>
          </div>
      </footer>
  </div>

  <!-- BOOTSTRAP AND JPOPPER-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
  <script src="{{url_for('static', filename= 'scripts/layout.js')}}"></script>
  <script>

    function ver_carro(){
      console.log('viendo carro')
      $.ajax({
        url: "{{url_for('tienda_bp.ver_carro')}}",
        type: 'post',
        success: function (resp) {
            console.log(resp)
            if (resp.productos){
                console.log('ahi respuesta del carro')
                
                $('#cuerpo-carro').empty()
                let productos = resp.productos
                console.log(productos)

                if(productos.length > 0){
                  $('.carro-vacio').hide()
                  $('#tabla-carro').show()
                  console.log('ahi productos')
                  for(let i = 0; i < productos.length ; i++){
                  let producto = productos[i]
                  let a = '<tr><td><div ><img class="item-carro-imagen" src="/imagen-producto/'+producto[1]+'"></div></td><td>'+producto[2]+'</td><td><button><i class="fa-solid fa-plus"></i></button>'
                  let b = '<input type="number"  id="" value="'+producto[3]+'" ><button><i class="fa-solid fa-minus"></i></button>'
                  let c = '</td><td><button><i class="fa-solid fa-trash"></i></button></td></tr>'
                  $('#cuerpo-carro').append(a+b+c)
                  }

                }
                else{
                  console.log('no ahi productos')
                  $('#tabla-carro').hide()
                  $('.carro-vacio').show()
                }
                
                
                $('#modal-carro').modal('show')
            }
        }
    });
      
    }
    
    function vaciar_carro(){
      console.log('vaciando carro')
      url = '{{url_for("tienda_bp.vaciar_carro")}}'
      $.post(url, function(data){
        if (data.mensaje){
          console.log(data.mensaje)
          $('#modal-carro').modal('hide')
          location.reload();
        }
        else{
          console.log('error al vaciar el carro')
        }
      })
    }
  
  </script>
</body>
</html>